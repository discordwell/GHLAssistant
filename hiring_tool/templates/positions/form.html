{% extends "base.html" %}
{% block title %}{% if position %}Edit{% else %}New{% endif %} Position â€” Hiring Tool{% endblock %}
{% block nav_positions %}active{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <h1 class="text-xl font-bold text-gray-900 mb-6">{% if position %}Edit Position{% else %}New Position{% endif %}</h1>

    <form method="post" action="{% if position %}/positions/{{ position.id }}/edit{% else %}/positions/new{% endif %}" class="space-y-4">
        <div>
            <label class="block text-sm font-medium text-gray-700">Title</label>
            <input type="text" name="title" value="{{ position.title if position else '' }}" required
                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-3 py-2">
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Department</label>
                <input type="text" name="department" value="{{ position.department if position and position.department else '' }}"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-3 py-2">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Status</label>
                <select name="status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-3 py-2">
                    {% for s in ["open", "paused", "filled", "closed"] %}
                    <option value="{{ s }}" {% if position and position.status == s %}selected{% endif %}>{{ s|title }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Salary Min</label>
                <input type="number" name="salary_min" value="{{ position.salary_min if position and position.salary_min else '' }}" step="1000"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-3 py-2">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Salary Max</label>
                <input type="number" name="salary_max" value="{{ position.salary_max if position and position.salary_max else '' }}" step="1000"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-3 py-2">
            </div>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700">Description</label>
            <textarea name="description" rows="4"
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-3 py-2">{{ position.description if position and position.description else '' }}</textarea>
        </div>

        <!-- Scoring Rubric -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Scoring Rubric</label>
            <div id="rubric-rows" class="space-y-2">
                {% if rubrics %}
                {% for r in rubrics %}
                <div class="flex items-center space-x-2 rubric-row">
                    <input type="text" name="rubric_criteria_{{ loop.index0 }}" value="{{ r.criteria }}" placeholder="Criteria"
                           class="flex-1 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
                    <input type="number" name="rubric_weight_{{ loop.index0 }}" value="{{ r.weight }}" step="0.1" placeholder="Weight" title="Weight"
                           class="w-20 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
                    <input type="number" name="rubric_max_{{ loop.index0 }}" value="{{ r.max_points }}" placeholder="Max" title="Max points"
                           class="w-20 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
                </div>
                {% endfor %}
                {% else %}
                <div class="flex items-center space-x-2 rubric-row">
                    <input type="text" name="rubric_criteria_0" placeholder="e.g., Technical Skills"
                           class="flex-1 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
                    <input type="number" name="rubric_weight_0" value="1.0" step="0.1" placeholder="Weight"
                           class="w-20 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
                    <input type="number" name="rubric_max_0" value="10" placeholder="Max"
                           class="w-20 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
                </div>
                {% endif %}
            </div>
            <button type="button" onclick="addRubricRow()" class="mt-2 text-xs text-indigo-600 hover:underline">+ Add criteria</button>
        </div>

        <div class="flex justify-end space-x-3 pt-4">
            <a href="/positions/" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">Cancel</a>
            <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">{% if position %}Save{% else %}Create{% endif %}</button>
        </div>
    </form>
</div>

<script>
function addRubricRow() {
    const container = document.getElementById('rubric-rows');
    const idx = container.children.length;
    const row = document.createElement('div');
    row.className = 'flex items-center space-x-2 rubric-row';
    row.innerHTML = `
        <input type="text" name="rubric_criteria_${idx}" placeholder="Criteria"
               class="flex-1 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
        <input type="number" name="rubric_weight_${idx}" value="1.0" step="0.1" placeholder="Weight"
               class="w-20 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
        <input type="number" name="rubric_max_${idx}" value="10" placeholder="Max"
               class="w-20 rounded-md border-gray-300 shadow-sm text-sm border px-3 py-1.5">
    `;
    container.appendChild(row);
}
</script>
{% endblock %}
