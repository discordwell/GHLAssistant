<div class="flex flex-col h-full">
    <div class="px-4 py-3 border-b bg-gray-50">
        <div class="flex items-center justify-between">
            <div>
                <span class="font-medium text-gray-900">{% if contact %}{{ contact.full_name }}{% else %}Unknown{% endif %}</span>
                <span class="text-xs text-gray-400 ml-2">{{ conversation.channel }}</span>
            </div>
            <form hx-post="/loc/{{ location.slug }}/conversations/{{ conversation.id }}/read" hx-swap="none">
                <button type="submit" class="text-xs text-indigo-600 hover:underline">Mark Read</button>
            </form>
        </div>
    </div>
    <div class="flex-1 overflow-y-auto p-4 space-y-3">
        {% for msg in messages %}
        <div class="{% if msg.direction == 'outbound' %}ml-auto bg-indigo-100{% else %}mr-auto bg-gray-100{% endif %} rounded-lg px-4 py-2 max-w-[75%]">
            {% if msg.subject %}<div class="text-xs font-medium text-gray-700 mb-1">{{ msg.subject }}</div>{% endif %}
            <div class="text-sm text-gray-800">{{ msg.body or '' }}</div>
            <div class="text-xs text-gray-400 mt-1">{{ msg.created_at.strftime('%b %d, %H:%M') }} &middot; {{ msg.status }}</div>
        </div>
        {% else %}
        <div class="text-gray-400 text-center text-sm">No messages</div>
        {% endfor %}
    </div>
    {% if contact %}
    <div class="border-t p-4 space-y-3">
        {% if sms_configured and contact.phone %}
        <form hx-post="/loc/{{ location.slug }}/conversations/{{ contact.id }}/sms" hx-target="#sms-result" class="flex gap-2">
            <input type="text" name="message" placeholder="Type SMS..." class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm">
            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700">SMS</button>
        </form>
        <div id="sms-result"></div>
        {% endif %}
        {% if email_configured and contact.email %}
        <form hx-post="/loc/{{ location.slug }}/conversations/{{ contact.id }}/email" hx-target="#email-result" class="space-y-2">
            <input type="text" name="subject" placeholder="Subject" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
            <textarea name="body" placeholder="Email body..." rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"></textarea>
            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700">Send Email</button>
        </form>
        <div id="email-result"></div>
        {% endif %}
    </div>
    {% endif %}
</div>
