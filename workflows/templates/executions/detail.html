{% extends "base.html" %}
{% set active_nav = "executions" %}

{% block title %}Execution Detail â€” MaxLevel{% endblock %}

{% block content %}
<div class="flex items-center gap-3 mb-6">
  <a href="/executions" class="text-gray-400 hover:text-white">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
    </svg>
  </a>
  <h1 class="text-2xl font-bold">
    {{ execution.workflow.name if execution.workflow else 'Execution' }}
  </h1>
  <span class="text-xs font-medium px-2.5 py-1 rounded-full
    {% if execution.status == 'completed' %}bg-emerald-500/10 text-emerald-400 border border-emerald-500/20
    {% elif execution.status == 'failed' %}bg-red-500/10 text-red-400 border border-red-500/20
    {% elif execution.status == 'running' %}bg-blue-500/10 text-blue-400 border border-blue-500/20
    {% else %}bg-gray-800 text-gray-400 border border-gray-700{% endif %}">
    {{ execution.status | title }}
  </span>
</div>

{% if execution.error_message %}
<div class="bg-red-500/10 border border-red-500/20 rounded-lg p-4 mb-6">
  <p class="text-sm text-red-400 font-mono">{{ execution.error_message }}</p>
</div>
{% endif %}

<!-- Step execution timeline -->
<h2 class="text-lg font-semibold mb-4">Step Timeline</h2>
<div class="space-y-2">
  {% for step_ex in execution.step_executions %}
  <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="w-2 h-2 rounded-full
          {% if step_ex.status == 'completed' %}bg-emerald-400
          {% elif step_ex.status == 'failed' %}bg-red-400
          {% elif step_ex.status == 'running' %}bg-blue-400 animate-pulse
          {% elif step_ex.status == 'skipped' %}bg-gray-600
          {% else %}bg-gray-400{% endif %}"></span>
        <span class="font-medium text-sm">
          {{ step_ex.step.label if step_ex.step else 'Unknown Step' }}
        </span>
        <span class="text-xs text-gray-500">{{ step_ex.status }}</span>
      </div>
      {% if step_ex.duration_ms %}
      <span class="text-xs text-gray-500">{{ step_ex.duration_ms }}ms</span>
      {% endif %}
    </div>
    {% if step_ex.error_message %}
    <p class="text-xs text-red-400 font-mono mt-2">{{ step_ex.error_message }}</p>
    {% endif %}
    {% if step_ex.output_data %}
    <details class="mt-2">
      <summary class="text-xs text-gray-500 cursor-pointer hover:text-gray-300">Output</summary>
      <pre class="text-xs text-gray-400 font-mono mt-1 bg-gray-800 rounded p-2 overflow-x-auto">{{ step_ex.output_data | tojson(indent=2) }}</pre>
    </details>
    {% endif %}
  </div>
  {% endfor %}

  {% if not execution.step_executions %}
  <p class="text-gray-500 text-sm">No step executions recorded.</p>
  {% endif %}
</div>
{% endblock %}
